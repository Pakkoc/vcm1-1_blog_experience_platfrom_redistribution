{% extends 'base.html' %}
{% load static %}

{% block title %}{{ campaign.name }} - 체험단 상세{% endblock %}

{% block content %}
<div class="container my-4">
    <!-- 1. 페이지 헤더 -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-5">{{ campaign.name }}</h1>
            <p class="text-muted">
                {{ campaign.advertiser.advertiser_profile.company_name }}
            </p>
        </div>
    </div>

    <!-- 2. 체험단 기본 정보 카드 -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">모집 정보</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>모집 기간:</strong></p>
                    <p>
                        {{ campaign.recruitment_start_date|date:"Y년 m월 d일" }} ~
                        {{ campaign.recruitment_end_date|date:"Y년 m월 d일" }}
                    </p>
                </div>
                <div class="col-md-6">
                    <p><strong>모집 인원:</strong></p>
                    <p>{{ campaign.recruitment_count }}명</p>
                </div>
            </div>

            <!-- 모집 상태 배지 -->
            <div class="mt-2">
                {% if campaign.status == 'recruiting' %}
                    <span class="badge bg-success">모집 중</span>
                {% elif campaign.status == 'recruitment_ended' %}
                    <span class="badge bg-secondary">모집 마감</span>
                {% elif campaign.status == 'selection_complete' %}
                    <span class="badge bg-info">선정 완료</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- 3. 제공 혜택 -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">제공 혜택</h5>
            <p class="card-text" style="white-space: pre-line;">{{ campaign.benefits }}</p>
        </div>
    </div>

    <!-- 4. 미션 내용 -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">미션</h5>
            <p class="card-text" style="white-space: pre-line;">{{ campaign.mission }}</p>
        </div>
    </div>

    <!-- 5. 지원 액션 영역 (조건부 렌더링) -->
    <div class="card border-primary">
        <div class="card-body">
            {% if can_apply %}
                <!-- 지원 가능 -->
                <h5 class="card-title text-primary">이 체험단에 지원하세요!</h5>
                <p class="card-text">
                    위 조건을 확인하셨다면 지원서를 작성하여 참여 의사를 전달해주세요.
                </p>
                <a href="{% url 'proposals:apply' campaign.pk %}" class="btn btn-primary btn-lg">
                    지원하기
                </a>

            {% elif already_applied %}
                <!-- 이미 지원 완료 -->
                <h5 class="card-title text-muted">지원 완료</h5>
                <p class="card-text">
                    이미 이 체험단에 지원하셨습니다.
                    선정 결과는 내 지원 목록에서 확인하실 수 있습니다.
                </p>
                <button type="button" class="btn btn-secondary btn-lg" disabled>
                    지원 완료
                </button>
                <a href="{% url 'proposals:my_proposals' %}" class="btn btn-outline-primary">
                    내 지원 목록 보기
                </a>

            {% elif cannot_apply_reason == 'login_required' %}
                <!-- 비로그인 -->
                <h5 class="card-title text-info">로그인 후 지원 가능합니다</h5>
                <p class="card-text">
                    이 체험단에 지원하려면 먼저 로그인해주세요.
                </p>
                <a href="{% url 'users:login' %}?next={{ request.path }}" class="btn btn-info btn-lg">
                    로그인하기
                </a>
                <a href="{% url 'users:signup' %}" class="btn btn-outline-info">
                    회원가입
                </a>

            {% elif cannot_apply_reason == 'advertiser_not_allowed' %}
                <!-- 광고주 계정 -->
                <h5 class="card-title text-muted">광고주는 체험단에 지원할 수 없습니다</h5>
                <p class="card-text">
                    광고주 계정으로는 체험단 지원이 불가능합니다.
                </p>

            {% elif cannot_apply_reason == 'recruitment_ended' or cannot_apply_reason == 'deadline_passed' %}
                <!-- 모집 종료 -->
                <h5 class="card-title text-danger">모집이 마감되었습니다</h5>
                <p class="card-text">
                    이 체험단의 모집이 종료되어 더 이상 지원할 수 없습니다.
                </p>
                <button type="button" class="btn btn-secondary btn-lg" disabled>
                    모집 마감
                </button>
                <a href="{% url 'campaigns:home' %}" class="btn btn-outline-primary">
                    다른 체험단 보기
                </a>

            {% endif %}
        </div>
    </div>

    <!-- 6. 뒤로 가기 버튼 -->
    <div class="mt-3">
        <a href="{% url 'campaigns:home' %}" class="btn btn-outline-secondary">
            목록으로 돌아가기
        </a>
    </div>
</div>
{% endblock %}
