{% extends 'base.html' %}

{% block title %}체험단 매칭 플랫폼 - 광고주와 인플루언서를 연결합니다{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section py-5 mb-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 text-center text-lg-start">
                <h1 class="display-4 fw-bold mb-3">광고주와 인플루언서를 연결하는<br>체험단 매칭 플랫폼</h1>
                <p class="lead mb-4">손쉽게 체험단을 등록하고, 다양한 체험 기회를 발견하세요</p>
                <div class="d-flex flex-column flex-sm-row justify-content-center justify-content-lg-start gap-3">
                    {% if not user.is_authenticated %}
                        <a href="{% url 'users:signup' %}" class="btn btn-light btn-lg px-4">
                            무료 회원가입
                        </a>
                        <a href="#campaigns-section" class="btn btn-outline-light btn-lg px-4">
                            체험단 둘러보기
                        </a>
                    {% else %}
                        {% if user.role == 'advertiser' %}
                            <a href="{% url 'campaigns:manage' %}" class="btn btn-light btn-lg px-4">
                                체험단 관리하기
                            </a>
                        {% else %}
                            <a href="#campaigns-section" class="btn btn-light btn-lg px-4">
                                체험단 둘러보기
                            </a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            <div class="col-lg-6 mt-4 mt-lg-0">
                <img src="https://images.unsplash.com/photo-1552581234-26160f608093?w=600&h=400&fit=crop"
                     alt="팀워크"
                     class="img-fluid rounded shadow-lg">
            </div>
        </div>
    </div>
</section>

<!-- 현재 모집 중인 체험단 섹션 -->
<section id="campaigns-section" class="mb-5" x-data="{
    searchQuery: '',
    sortBy: 'latest',
    get filteredCampaigns() {
        let campaigns = Array.from(document.querySelectorAll('.campaign-card'));

        // 검색 필터
        if (this.searchQuery) {
            campaigns = campaigns.filter(card => {
                const title = card.dataset.title.toLowerCase();
                const advertiser = card.dataset.advertiser.toLowerCase();
                const query = this.searchQuery.toLowerCase();
                return title.includes(query) || advertiser.includes(query);
            });
        }

        return campaigns;
    },
    filterCampaigns() {
        const allCampaigns = document.querySelectorAll('.campaign-card');
        const filtered = this.filteredCampaigns;

        allCampaigns.forEach(card => {
            card.parentElement.style.display = filtered.includes(card) ? 'block' : 'none';
        });

        // 빈 상태 메시지 표시
        const emptyState = document.getElementById('empty-campaigns');
        if (emptyState) {
            emptyState.style.display = filtered.length === 0 ? 'block' : 'none';
        }
    }
}">
    <div class="container">
        <h2 class="text-center mb-4">현재 모집 중인 체험단</h2>

        {% if campaigns %}
        <!-- 검색 및 필터 -->
        <div class="row mb-4">
            <div class="col-md-8 mx-auto">
                <div class="input-group">
                    <span class="input-group-text">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                    </span>
                    <input type="text"
                           class="form-control"
                           placeholder="체험단명 또는 광고주명으로 검색..."
                           x-model="searchQuery"
                           @input.debounce.300ms="filterCampaigns()">
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row">
            {% if campaigns %}
                {% for campaign in campaigns %}
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 shadow-sm campaign-card"
                         data-title="{{ campaign.name }}"
                         data-advertiser="{{ campaign.advertiser.name }}"
                         data-date="{{ campaign.recruitment_end_date|date:'Y-m-d' }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ campaign.name }}</h5>
                            <h6 class="card-subtitle mb-2 text-muted">
                                {{ campaign.advertiser.name }}
                            </h6>
                            <p class="card-text">
                                <small class="text-muted">
                                    모집 인원: {{ campaign.recruitment_count }}명<br>
                                    모집 마감: {{ campaign.recruitment_end_date|date:"Y.m.d" }}
                                </small>
                            </p>
                            <p class="card-text">{{ campaign.benefits|truncatewords:15 }}</p>
                        </div>
                        <div class="card-footer bg-transparent">
                            <a href="{% url 'campaigns:detail' campaign.pk %}" class="btn btn-outline-primary btn-sm w-100">
                                상세 보기
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <!-- 검색 결과 없음 메시지 -->
                <div class="col-12" id="empty-campaigns" style="display: none;">
                    <div class="alert alert-warning text-center" role="alert">
                        <h4>검색 결과가 없습니다.</h4>
                        <p class="mb-0">다른 검색어로 시도해보세요.</p>
                    </div>
                </div>
            {% else %}
                <div class="col-12">
                    <div class="alert alert-info text-center" role="alert">
                        <h4>현재 모집 중인 체험단이 없습니다.</h4>
                        <p class="mb-0">곧 새로운 체험단이 등록될 예정입니다.</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- 플랫폼 특징 섹션 -->
<section class="features-section py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-5">왜 우리 플랫폼을 선택해야 할까요?</h2>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <img src="https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400&h=250&fit=crop"
                         alt="빠른 매칭"
                         class="card-img-top">
                    <div class="card-body text-center">
                        <h4 class="card-title">빠른 매칭</h4>
                        <p class="card-text text-muted">간편한 등록과 지원으로 신속하게 체험단을 시작하세요</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <img src="https://images.unsplash.com/photo-1521791136064-7986c2920216?w=400&h=250&fit=crop"
                         alt="검증된 파트너"
                         class="card-img-top">
                    <div class="card-body text-center">
                        <h4 class="card-title">검증된 파트너</h4>
                        <p class="card-text text-muted">신뢰할 수 있는 광고주와 인플루언서만 선별합니다</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <img src="https://images.unsplash.com/photo-1551434678-e076c223a692?w=400&h=250&fit=crop"
                         alt="효과적인 홍보"
                         class="card-img-top">
                    <div class="card-body text-center">
                        <h4 class="card-title">효과적인 홍보</h4>
                        <p class="card-text text-muted">실제 사용자의 생생한 리뷰로 진정성 있는 마케팅을 실현합니다</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 이용 방법 섹션 -->
<section class="how-it-works py-5">
    <div class="container">
        <h2 class="text-center mb-5">이용 방법</h2>
        <div class="row">
            <!-- 광고주 -->
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow">
                    <img src="https://images.unsplash.com/photo-1556761175-b413da4baf72?w=600&h=300&fit=crop"
                         alt="광고주"
                         class="card-img-top">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">광고주</h4>
                    </div>
                    <div class="card-body">
                        <ol class="ps-3">
                            <li class="mb-2"><strong>회원가입</strong> - 사업자 정보로 간편 가입</li>
                            <li class="mb-2"><strong>체험단 등록</strong> - 혜택과 미션을 명시</li>
                            <li class="mb-2"><strong>지원자 확인</strong> - 적합한 인플루언서 선택</li>
                            <li class="mb-2"><strong>체험단 선정</strong> - 최종 참여자 확정</li>
                        </ol>
                        {% if not user.is_authenticated %}
                        <a href="{% url 'users:signup' %}" class="btn btn-primary w-100 mt-3">
                            광고주로 시작하기
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- 인플루언서 -->
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow">
                    <img src="https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?w=600&h=300&fit=crop"
                         alt="인플루언서"
                         class="card-img-top">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">인플루언서</h4>
                    </div>
                    <div class="card-body">
                        <ol class="ps-3">
                            <li class="mb-2"><strong>회원가입</strong> - SNS 채널 정보 등록</li>
                            <li class="mb-2"><strong>체험단 탐색</strong> - 관심 있는 체험단 확인</li>
                            <li class="mb-2"><strong>지원서 작성</strong> - 각오와 방문 희망일 제출</li>
                            <li class="mb-2"><strong>선정 확인</strong> - 내 지원 목록에서 결과 확인</li>
                        </ol>
                        {% if not user.is_authenticated %}
                        <a href="{% url 'users:signup' %}" class="btn btn-success w-100 mt-3">
                            인플루언서로 시작하기
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA 섹션 -->
{% if not user.is_authenticated %}
<section class="cta-section py-5 bg-primary text-white">
    <div class="container text-center">
        <h2 class="mb-3">지금 바로 시작하세요!</h2>
        <p class="lead mb-4">무료 회원가입으로 다양한 체험단 기회를 만나보세요</p>
        <a href="{% url 'users:signup' %}" class="btn btn-light btn-lg px-5">
            무료 회원가입
        </a>
    </div>
</section>
{% endif %}

<style>
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}
.hero-section h1, .hero-section p {
    color: white;
}
</style>
{% endblock %}
